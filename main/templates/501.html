<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>503 — Service unavailable</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#7dd3fc;
    --accent2:#f472b6;
    --muted:#9aa6b2;
    --warn-yellow:#ffea00;
    --warn-black:#000000;
    font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:
      radial-gradient(1000px 500px at 10% 10%, rgba(125,211,252,0.06), transparent),
      radial-gradient(700px 350px at 90% 90%, rgba(168,85,247,0.03), transparent),
      var(--bg);
    color:#e6eef6;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    position:relative;
    overflow:hidden;
  }
  .warn-bar{position:absolute;top:0;width:60px;height:200%;background:repeating-linear-gradient(45deg,var(--warn-yellow) 0 15px,var(--warn-black) 15px 30px);z-index:0;pointer-events:none;}
  .warn-bar-left{ left:0; animation: move-down 25s linear infinite; }
  .warn-bar-right{ right:0; animation: move-up 25s linear infinite; }
  @keyframes move-down{ 0% { transform: translateY(-50%); } 100% { transform: translateY(0%); } }
  @keyframes move-up{ 0% { transform: translateY(0%); } 100% { transform: translateY(-50%); } }
  .wrap{max-width:920px;width:100%;z-index:1;position:relative}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    border-radius:14px;
    padding:28px;
    backdrop-filter:blur(6px);
    box-shadow:0 10px 30px rgba(2,6,23,0.6);
    text-align:center;
  }
  h1{font-size:36px;margin:12px 0 8px 0;}
  h2{margin:8px 0;font-weight:400;color:#d3d3d3;}
  .actions{margin-top:20px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;}
  .btn{
    background:linear-gradient(90deg,var(--accent), #60a5fa);
    color:#07203a;
    padding:12px 20px;
    border-radius:10px;
    border:none;
    font-weight:600;
    text-decoration:none;
    font-size:16px;
    display:inline-block;
  }
  .btn.rickroll{
    background:linear-gradient(90deg,var(--accent2), #fbbf24);
    color:#07203a;
  }
  .svg-wrap{display:flex;justify-content:center;margin-top:28px;z-index:1;position:relative}
  .scene{width:520px;max-width:100%}
  @keyframes floaty{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
  .float{animation:floaty 4s ease-in-out infinite}
  @media (max-width:560px){h1{font-size:28px}.btn{font-size:14px;padding:10px 16px}}
</style>
</head>
<body>

<div class="warn-bar warn-bar-left"></div>
<div class="warn-bar warn-bar-right"></div>

<div class="wrap">
  <main class="card" role="main" aria-labelledby="title">
    <h2>Well... Fu$#.</h2>
    <h1 id="title">The system is down right now</h1>
    <h2>We are just doing some Maintenance. It'll be online again soon.</h2>

    <br>
    <h1>Wartet bis wir euch sagen, dass ihr wieder weitermachen könnt!</h1>
    <h2>It should be online again any second now... just try going to the homepage.</h2>

    <div class="actions">
      <a class="btn" href="/">← Zurück zur Startseite</a>
      <a class="btn rickroll" href="https://youtu.be/xvFZjo5PgG0?si=p_Z3F-2aSa_jEqcE" target="_blank">Get rickrolled</a>
    </div>

    <!-- Letzte Seite pro Tab -->
    <h2 style="margin-top:30px;">Wartungsmodus aktiv</h2>
    <p style="color:#a0c4ff; font-size:16px;">
      Sie waren zuletzt auf: <span id="last-url" style="font-weight:600;">/</span>
    </p>

    <!-- Passwort / Bypass Form -->
    <div class="maintenance-info" style="margin-top:20px;">
{% if show_password_form %}
<form method="post" action="{% url 'maintenance-page' %}">
    {% csrf_token %}
    <label for="password">Enter Maintenance Password:</label>
    <input type="password" name="password" id="password">
    <button type="submit">Submit</button>
</form>
{% endif %}

{% if bypass %}
<div style="position: fixed; bottom: 10px; right: 10px; z-index: 999;">
    <form method="post" action="{% url 'maintenance-page' %}">
        {% csrf_token %}
        <input type="hidden" name="deactivate_bypass" value="1">
        <button type="submit" style="background:#f87171;color:white;padding:8px 12px;border:none;border-radius:6px;">
            Wartung zurücksetzen
        </button>
    </form>
</div>
{% endif %}

    </div>

  </main>

  <div class="svg-wrap" aria-hidden="true">
    <svg class="scene float" viewBox="0 0 600 300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Dekorative Illustration">
      <defs>
        <linearGradient id="grad500" x1="0" x2="1">
          <stop offset="0" stop-color="#7dd3fc" stop-opacity="0.95"/>
          <stop offset="1" stop-color="#60a5fa" stop-opacity="0.95"/>
        </linearGradient>
      </defs>
      <rect x="120" y="60" width="360" height="200" rx="16" fill="#071226" stroke="url(#grad500)" stroke-width="4"/>
      <rect x="220" y="260" width="160" height="20" rx="6" fill="#7dd3fc" opacity="0.2"/>
      <line x1="230" y1="130" x2="250" y2="150" stroke="#7dd3fc" stroke-width="4" stroke-linecap="round"/>
      <line x1="250" y1="130" x2="230" y2="150" stroke="#7dd3fc" stroke-width="4" stroke-linecap="round"/>
      <line x1="350" y1="130" x2="370" y2="150" stroke="#7dd3fc" stroke-width="4" stroke-linecap="round"/>
      <line x1="370" y1="130" x2="350" y2="150" stroke="#7dd3fc" stroke-width="4" stroke-linecap="round"/>
      <path d="M250 200 Q300 170 350 200" stroke="#7dd3fc" stroke-width="6" fill="none" stroke-linecap="round"/>
    </svg>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Nur echte Seiten als "letzte Seite" speichern
   // Liste der Pfade, die nicht als "letzte Seite" gespeichert werden sollen
    const skipPaths = ["/501/", "/503/"];
    const path = window.location.pathname;

    // Nur echte Seiten speichern
    if (
        !path.startsWith("/api/") &&
        !path.startsWith("/static/") &&
        !path.startsWith("/favicon.ico") &&
        !path.startsWith("/admin/") &&
        !skipPaths.includes(path)
    ) {
        sessionStorage.setItem("last_url", window.location.href);
    }

    // Anzeigen
    const lastUrlEl = document.getElementById("last-url");
    const lastUrl = sessionStorage.getItem("last_url") || "/";
    lastUrlEl.textContent = lastUrl;

    // Optional: Passwortformular mit hidden field füllen
    const bypassForm = document.getElementById("bypass-form");
    if (bypassForm) {
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "last_url";
        input.value = lastUrl;
        bypassForm.appendChild(input);
    }

    // Wartungs-Status prüfen und ggf. weiterleiten
    function checkMaintenance() {
        fetch('/api/site-status/')
            .then(res => res.json())
            .then(data => {
                if (!data.maintenance_mode || data.bypass) {
                    //window.location.href = lastUrl;
                }
            })
            .catch(err => console.error('Site status check failed', err));
    }

    setInterval(checkMaintenance, 5000);
    checkMaintenance(); // sofort prüfen
});
</script>

</body>
</html>
