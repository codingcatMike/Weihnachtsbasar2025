{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pay Screen</title>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }
        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        tr:nth-child(even) {
            background-color: #dddddd;
        }
    </style>
</head>
<body>

<h2>Aktuelle Bestellung</h2>
<div id="order-container">
    <!-- Order table will appear here -->
</div>

<script>
let socket = new WebSocket("ws://" + window.location.host + "/ws/pay_screen/");

socket.onopen = function() {
    console.log("Connected to PayScreen WebSocket");
};

socket.onclose = function() {
    console.log("Disconnected from PayScreen WebSocket");
};

socket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    const container = document.getElementById("order-container");

    // Clear display if order is None
    if(data.order === null) {
        container.innerHTML = "<p>Keine Bestellung angezeigt</p>";
        return;
    }

    if(data.order) {
        const order = data.order;
        let itemsHtml = order.items.map(item => 
            `<tr>
                <td>${item.quantity}</td>
                <td>${item.name}</td>
                <td>${item.price}€</td>
                <td>${(item.quantity * item.price)}€</td>
            </tr>`).join("");

        const tableHtml = `
            <table>
                <tr>
                    <th>Anzahl</th>
                    <th>Produkt</th>
                    <th>Einzelpreis</th>
                    <th>Gesamt</th>
                </tr>
                ${itemsHtml}
                <tr>
                    <td colspan="3"><strong>Total (innsgesammt):</strong></td>
                    <td><strong>${order.price}€</strong></td>
                </tr>
            </table>
        `;

        container.innerHTML = tableHtml;
    }

    // Optionally handle order removal if it's paid
    if(data.paid_order_id) {
        container.innerHTML = "<p>Keine Bestellung angezeigt</p>";
    }
};
</script>

</body>
</html>
