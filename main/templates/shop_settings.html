{% extends 'base.html' %}
{% load static %}
{% block title %}Shop Settings{% endblock title %}

{% block content %}
<div style="max-width: 900px; margin: 80px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">

    <!-- Back to Shop Button -->
    <div style="margin-bottom: 20px;">
        <button type="button" onclick="window.location.href='/Shop/{{ shop.id }}/';" style="padding: 8px 12px;">← Back to Shop</button>
    </div>

    <h1>{{ shop.name }} Settings</h1>

    <!-- Change Shop Name -->
    <section style="margin-bottom: 30px;">
        <h2>Change Shop Name</h2>
        <form method="post" action="{% url 'ShopSettings' shop.id %}">
            {% csrf_token %}
            <input type="text" name="shop_name" value="{{ shop.name }}" required>
            <input type="submit" name="update_name" value="Update Name">
        </form>
    </section>

    <!-- Products -->
    <section style="margin-bottom: 30px;">
        <h2>Products</h2>
        <button type="button" onclick="window.location.href='/create-product/'">➕ Add New Product</button>

        {% if shop.product_set.all %}
        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; text-align: left;">
            <thead>
                <tr>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Name</th>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Price</th>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in shop.product_set.all %}
                <tr>
                    <td style="padding: 5px;">{{ product.name }}</td>
                    <td style="padding: 5px;">
                        <form method="post" style="display:inline-block;" action="{% url 'ShopSettings' shop.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="product_id" value="{{ product.id }}">
                            <input type="number" step="0.01" name="price" value="{{ product.price }}" style="width:70px;">
                            <input type="submit" name="update_price" value="Update">
                        </form>
                    </td>
                    <td style="padding: 5px;">
                        <form method="post" style="display:inline-block;" action="{% url 'ShopSettings' shop.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="remove_product_id" value="{{ product.id }}">
                            <input type="submit" value="Delete">
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>No products yet.</p>
        {% endif %}
    </section>

    <!-- Sellers -->
    <section style="margin-bottom: 30px;">
        <h2>Sellers</h2>
        {% if shop.sellers.all %}
        <table style="width: 100%; border-collapse: collapse; text-align: left; margin-top: 10px;">
            <thead>
                <tr>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Username</th>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Email</th>
                    <th style="border-bottom: 1px solid #ccc; padding: 5px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for seller in shop.sellers.all %}
                <tr>
                    <td style="padding: 5px;">{{ seller.username }}</td>
                    <td style="padding: 5px;">{% if seller.email %}{{ seller.email }}{% else %}-{% endif %}</td>
                    <td style="padding: 5px;">
                        <form method="post" style="display:inline-block;" action="{% url 'ShopSettings' shop.id %}">
                            {% csrf_token %}
                            <input type="hidden" name="remove_seller_id" value="{{ seller.id }}">
                            <input type="submit" value="Remove">
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>No sellers assigned yet.</p>
        {% endif %}

        <!-- Add Seller Form -->
        <form method="post" action="{% url 'ShopSettings' shop.id %}" style="margin-top: 10px;">
            {% csrf_token %}
            <label for="username">Add Seller by Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter username" required>
            <input type="submit" name="add_seller" value="Add Seller">
        </form>
    </section>

    <!-- Shop Info -->
    <section style="margin-bottom: 30px;">
        <h2>Shop Info</h2>
        <p>Shop ID: {{ shop.id }}</p>
        <p>Number of products: {{ shop.product_set.count }}</p>
    </section>
</div>
{% endblock content %}
