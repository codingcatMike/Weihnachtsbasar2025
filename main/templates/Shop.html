{% extends "base.html" %}
{% block title %}Shop{% endblock title %}
{% block content %}
<script defer>
orders = []
orders_name =  []
function AddProduct(id, name) {
    console.log(id);
    if (id != null && id != "") {
        orders.push(id);
        name = " " + name;
        orders_name.push(name);
        console.log("Produkte im Warenkorb: " + orders_name);
        document.getElementById("orders").innerHTML = "Produkte im Warenkorb: " + orders_name;
    } else {
        console.log("Ungültige Produkt-ID");
        return;
    }
}


function SendOrder() {
    if (orders.length === 0) {
        alert("Bitte fügen Sie Produkte zum Warenkorb hinzu.");
        return;
    }
    const customerId = document.querySelector('input[name="customer_id"]').value;
    if (!customerId) {
        alert("Bitte geben Sie eine Kunden ID ein.");
        return;
    }

    fetch("{% url 'sendOrder' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({
            customer_id: customerId,
            products: orders
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("Server error: " + response.status);
        }
        return response.json(); // or .text() depending on your Django view
    })
    .then(data => {
        console.log("Antwort vom Server:", data);
        location.reload();
    })
    .catch(err => {
        console.error("Fehler beim Senden:", err);
        alert("Es gab ein Problem mit der Bestellung.");
    });
    
}

</script>
<div class="container">
    <h1>{{ shop.name }} </h1>
        <div style="align-items: center; justify-content: center;">
            Kunden ID: <input type="text" name="customer_id" id="customer_id" placeholder="Kunden ID" autocomplete="off" style="background-color: rgb(214, 214, 214);">

        </div>
    {% for product in products %}
    <button style="margin-top: 10px;" onclick="AddProduct({{ product.id }}, '{{product.name}}')">{{ product.name }} - {{ product.price }}€</button>
    {% endfor %}
    <button type="submit" style="margin-top: 30px; background-color: rgb(136, 255, 0);" onclick="SendOrder()">Senden</button>
    <button style="position: absolute; bottom: 30px; left: 0px; background-color: rgb(255, 0, 0);" onclick="location.reload()">Alle Felder Löschen</button>
    <div id="orders"> Produkte im Warenkorb: </div>
</div>

<button style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; position: fixed; bottom: 10px; right: 10px; background-color: rgb(0, 0, 0); color: white; border-radius: 50%; border: none; cursor: pointer;" onclick="window.location.href='/Shop/{{ shop.id }}/settings';" title="Shop Settings" aria-label="Shop Settings" tabindex="0" role="button" aria-pressed="false" style="background-color: #007bff; color: white; font-size: 24px; padding: 10px; border-radius: 50%; border: none; cursor: pointer;"
    >
    ⚙️
</button>

{% endblock %}

